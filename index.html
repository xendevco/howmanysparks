<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spark of Omens Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 20%;
        }
        h1 {
            color: #4CAF50;
        }
        p {
            font-size: 1.5rem;
        }
        .script-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
            max-width: 80%;
            overflow-x: auto;
        }
        button {
            padding: 5px 10px;
            font-size: 0.9rem;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #e0e0e0;
        }
        button:hover {
            background-color: #d6d6d6;
        }
        .counter-container {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Spark of Omens Tracker</h1>
    <p id="fractured"></p>
    <p id="spark"></p>

    <h2>Weapon Crafting Costs</h2>
    <label>
        <input type="checkbox" id="oneHandCheckbox" onchange="handleCheckboxChange('1H')"> 1H + Offhand
    </label>
    <label>
        <input type="checkbox" id="twoHandCheckbox" onchange="handleCheckboxChange('2H')"> Two-Handed Weapon
    </label>
    <div class="counter-container">
        <p>Sparks Already Used: <span id="usedSparksCounter">0</span></p>
        <button onclick="adjustSparks(-1)">-1</button>
        <button onclick="adjustSparks(1)">+1</button>
    </div>
    <p id="selected-craft">Select a weapon option to see the total crest costs.</p>
    <p id="mythic-runs"></p>

    <div class="script-container">
        <pre id="wowScript">Generating script...</pre>
        <button onclick="copyToClipboard()">Copy</button>
    </div>

    <script>
        const expansionReleaseDate = new Date('2024-08-26');
        const today = new Date();
        const weeksSinceRelease = Math.floor((today - expansionReleaseDate) / (7 * 24 * 60 * 60 * 1000));
        const fracturedSparks = weeksSinceRelease + 1;
        const totalSparks = Math.floor(fracturedSparks / 2);
        let usedSparks = 0;

        document.getElementById("fractured").innerText = `Fractured Spark of Omens: ${fracturedSparks}`;
        document.getElementById("spark").innerText = `Spark of Omens: ${totalSparks}`;

        const costPerItem = { "619": 45, "636": 90 };
        const twoHandCrestCosts = { "619": costPerItem["619"], "636": costPerItem["636"] };
        const oneHandOffhandCrestCosts = { "619": costPerItem["619"] * 2, "636": costPerItem["636"] * 2 };

        function adjustSparks(amount) {
            usedSparks = Math.max(0, Math.min(totalSparks, usedSparks + amount));
            document.getElementById("usedSparksCounter").innerText = usedSparks;
            updateDisplay();
        }

        function handleCheckboxChange(selected) {
            const oneHandCheckbox = document.getElementById("oneHandCheckbox");
            const twoHandCheckbox = document.getElementById("twoHandCheckbox");

            if (selected === '1H') {
                twoHandCheckbox.checked = false;
            } else if (selected === '2H') {
                oneHandCheckbox.checked = false;
            }
            updateDisplay();
        }

        function calculateTotal(craftingType, remainingSparks) {
            const sparksRequired = 2; // Both weapon types use 2 Sparks
            const itemsCrafted = craftingType === "2H" ? 1 : 2; // 1 item for 2H, 2 for 1H + Offhand
            const remainingItems = Math.max(remainingSparks - sparksRequired, 0);

            const runedCrestsRequired = craftingType === "2H" ? twoHandCrestCosts["619"] : oneHandOffhandCrestCosts["619"];
            const gildedCrestsRequired = craftingType === "2H" ? twoHandCrestCosts["636"] : oneHandOffhandCrestCosts["636"];

            return {
                totalRuned: runedCrestsRequired + remainingItems * costPerItem["619"],
                totalGilded: gildedCrestsRequired + remainingItems * costPerItem["636"],
                totalItems: itemsCrafted + remainingItems,
                sparksUsed: sparksRequired + remainingItems,
            };
        }

        function calculateMythicRuns(totalCrests, crestsPerRun) {
            return Math.ceil(totalCrests / crestsPerRun);
        }

        function updateDisplay() {
            const isOneHandSelected = document.getElementById("oneHandCheckbox").checked;
            const isTwoHandSelected = document.getElementById("twoHandCheckbox").checked;
            const remainingSparks = Math.max(totalSparks - usedSparks, 0);

            if (!isOneHandSelected && !isTwoHandSelected) {
                document.getElementById("selected-craft").innerText = "Select a weapon option to see the total crest costs.";
                document.getElementById("mythic-runs").innerText = "";
                return;
            }

            const craftingType = isOneHandSelected ? "1H" : "2H";
            const { totalRuned, totalGilded, totalItems, sparksUsed } = calculateTotal(craftingType, remainingSparks);

            const onTimeRuned = calculateMythicRuns(totalRuned, 12);
            const failedRuned = calculateMythicRuns(totalRuned, 5);
            const onTimeGilded = calculateMythicRuns(totalGilded, 12);
            const failedGilded = calculateMythicRuns(totalGilded, 5);

            document.getElementById("selected-craft").innerText = `
                Total Crest Costs (${craftingType === "2H" ? "Two-Handed Weapon" : "1H + Offhand"}):
                - Total Items Crafted: ${totalItems} (using ${sparksUsed} Sparks)
                - 619: ${totalRuned} Runed Harbinger's Crests
                - 636: ${totalGilded} Gilded Harbinger's Crests
            `;

            document.getElementById("mythic-runs").innerText = `
                Mythic+ Runs Required (On Time):
                - ${onTimeRuned} runs at levels 4-7 for Runed Harbinger's Crests
                - ${onTimeGilded} runs at levels 8+ for Gilded Harbinger's Crests

                Mythic+ Runs Required (Not On Time):
                - ${failedRuned} runs at levels 4-7 for Runed Harbinger's Crests
                - ${failedGilded} runs at levels 8+ for Gilded Harbinger's Crests
            `;
        }

        const wowScript = `/run a=C_CurrencyInfo.GetCurrencyInfo(3023) print("You have earned " .. a.totalEarned .. " of " .. a.maxQuantity .. " possible Fractured Spark of Omens")`;
        document.getElementById('wowScript').innerText = wowScript;

        function copyToClipboard() {
            const scriptText = document.getElementById('wowScript').innerText;
            navigator.clipboard.writeText(scriptText).then(() => {
                alert('Script copied to clipboard!');
            }).catch(err => {
                alert('Failed to copy script: ' + err);
            });
        }

        updateDisplay();
    </script>
</body>
</html>
